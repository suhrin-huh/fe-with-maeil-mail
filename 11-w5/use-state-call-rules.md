# 왜 useState를 조건문 안에서 사용하면 안 되나요?

## React의 Hook

Hook(훅)은 React 함수 컴포넌트에서 상태(state)와 React의 렌더링 과정에 따른 기능(생명주기, context 등)을 사용할 수 있게 해주는 특별한 함수이다. 원래 클래스 컴포넌트에서만 사용 가능했던 상태 관리와 생명주기 기능을, 함수 컴포넌트에서도 사용할 수 있도록 제공하는 것이 Hook의 핵심 목적이다.

React의 함수 컴포넌트는 여러 훅을 사용하여 상태와 렌더링 로직을 구성한다. 이때 React는 훅이 호출된 순서(order)를 기준으로 상태를 저장 및 관리한다. 따라서 훅은 매 렌더링마다 동일한 방식으로 호출되어야 하며, 이를 보장하기 위한 규칙이 필요하다.

## 훅의 순서 기반 상태 관리

React는 컴포넌트가 렌더링될 때 호출되는 훅을 내부적으로 배열과 유사한 구조에 순서대로 기록한다. 다음 렌더링에서도 동일한 위치의 훅을 동일한 상태와 연결하여 일관성을 유지한다.

```jsx
function exampleFtn() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState("Lee");

  return (
    <div>
      {count} / {name}
    </div>
  );
}
```

위의 코드에 대해 React는 내부적으로 다음과 같이 기록한다.

> 첫 번째 훅 -> `count` 상태
>
> 두 번째 훅 -> `name` 상태

다음 렌더링에서도 동일한 순서로 훅이 호출되어 상태를 안정적으로 매칭할 수 있다.

## 조건문 내 훅 호출

그럼, 조건문 내부에서 훅을 호출하면 어떻게 될까?
조건문 내부에서 훅을 호출하면, 렌더링마다 훅이 실행되는 개수와 위치가 달라질 가능성이 생간다. 이는 React의 "순서 기반 매핑" 규칙에 어긋난다.

```jsx
function exampleFtn({ enabled }) {
  if (enabled) {
    const [count, setCount] = useState(0);

    const [name, setName] = useState("Lee");

    return <div>Example</div>;
  }
}
```

위의 코드에서 enabled 값에 따라 훅 호출의 순서가 달라진다.

|            | `enabled == true` | `enabled == false` |
| ---------- | ----------------- | ------------------ |
| 첫 번째 훅 | `count`           | `name`             |
| 두 번째 훅 | `name`            | 존재 X             |

React는 첫 번째 위치에 존재하는 훅이 무엇인지에 따라 상태를 추적하기 때문에, 위와 같은 상황은 상태가 서로 다른 훅에 매핑되는 오류가 발생한다. `enabled`가 false일 때 첫 번째 훅이 `name`이므로, `name` 값이 갑자기 `count` 값이 되는 오류가 발생할 수 있는 것이다.

## 훅의 호출 위치

React는 위와 같은 문제를 방지하기 위해 다음과 같은 규칙을 제시한다.

- 훅은 조건문, 반복문, 중첩 함수 내부에서 호출하면 안 된다.

- 훅은 컴포넌트 또는 커스텀 훅의 최상위 수준에서 호출해야 한다.

## 결론

`useState`를 조건문 안에서 사용하지 않는 이유는 React가 훅을 호출하는 순서를 기반으로 상태를 식별하기 때문이다. 조건에 따라 훅이 호출되거나 생략되면 호출 순서가 달라지고, 이는 상태 매핑의 불일치를 초래한다. 따라서 모든 훅은 컴포넌트의 최상위에서 항상 동일한 순서로 호출되어야 한다.
